import pytest
from suds.sudsobject import Factory as SudsFactory

from soap_to_rest.suds_converter import to_serializable


def test_single_primordial_value():
    assert [5] == to_serializable(5)


def test_multiple_primordial_values():
    assert ["Hello", "World"] == to_serializable(["Hello", "World"])


def test_single_regular_object():
    regular_object = RegularObject("Jim Doe", "123 Front Street")

    assert regular_object == to_serializable(regular_object)


def test_single_suds_object():
    suds_object = SudsFactory.object(
        dict={"name": "John Doe", "address": "123 Jump Street"}
    )

    assert {"name": "John Doe", "address": "123 Jump Street"} == to_serializable(
        suds_object
    )


def test_multiple_regular_objects():
    regular_objects = [
        RegularObject("Jim Doe", "123 Front Street"),
        RegularObject("Billy Doe", "456 Front Street"),
    ]

    assert regular_objects == to_serializable(regular_objects)


def test_multiple_suds_objects():
    suds_objects = SudsFactory.object(
        dict={
            "person": [
                SudsFactory.object(
                    dict={"name": "John Doe", "address": "123 Jump Street"}
                ),
                SudsFactory.object(
                    dict={"name": "Jammy Doe", "address": "456 Jump Street"}
                ),
            ]
        }
    )

    assert [
        {"name": "John Doe", "address": "123 Jump Street"},
        {"name": "Jammy Doe", "address": "456 Jump Street"},
    ] == to_serializable(suds_objects)


def test_nested_suds_objects():
    suds_objects = SudsFactory.object(
        dict={
            "person": [
                SudsFactory.object(
                    dict={
                        "name": "John Doe",
                        "address": "123 Jump Street",
                        "pets": SudsFactory.object(
                            dict={"pet": [SudsFactory.object(dict={"name": "Scrappy"})]}
                        ),
                    }
                ),
                SudsFactory.object(
                    dict={
                        "name": "Jammy Doe",
                        "address": "456 Jump Street",
                        "pets": SudsFactory.object(
                            dict={"pet": [SudsFactory.object(dict={"name": "Bella"})]}
                        ),
                    }
                ),
            ]
        }
    )


def test_nested_mixed_objects():
    suds_objects = SudsFactory.object(
        dict={
            "person": [
                SudsFactory.object(
                    dict={
                        "name": "John Doe",
                        "address": "123 Jump Street",
                        "pets": [SudsFactory.object(dict={"name": "Scrappy"})],
                    }
                ),
                SudsFactory.object(
                    dict={
                        "name": "Jammy Doe",
                        "address": "456 Jump Street",
                        "pets": [SudsFactory.object(dict={"name": "Bella"})],
                    }
                ),
            ]
        }
    )

    assert [
        {
            "name": "John Doe",
            "address": "123 Jump Street",
            "pets": [{"name": "Scrappy"}],
        },
        {
            "name": "Jammy Doe",
            "address": "456 Jump Street",
            "pets": [{"name": "Bella"}],
        },
    ] == to_serializable(suds_objects)


class RegularObject:
    def __init__(self, name, address):
        self.name = name
        self.address = address
